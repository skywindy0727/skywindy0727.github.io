<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¾³é–€è‘¡å¼é¢¨æƒ…ä¹‹æ—… + é€£ç’°ç•«</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=Noto+Sans+TC:wght@400;700&family=Bangers&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        /* --- ä¸»é¡Œæ¨£å¼ --- */
        :root {
            --portugal-blue: #005DC7;
            --tile-bg: #F0F4F8;
            --comic-border: 3px solid #000;
            --comic-shadow: 4px 4px 0px #000;
        }

        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: var(--tile-bg); 
            padding-bottom: 90px; 
            color: #333;
        }

        h1, h2, h3, .serif-font { font-family: 'Playfair Display', serif; }
        .comic-font { font-family: 'Bangers', cursive; letter-spacing: 1px; }

        /* è‘¡å¼ç£ç£šèƒŒæ™¯ */
        .bg-azulejos {
            background-color: var(--portugal-blue);
            background-image: radial-gradient(circle at 100% 150%, var(--portugal-blue) 24%, white 25%, white 28%, var(--portugal-blue) 29%, var(--portugal-blue) 36%, white 36%, white 40%, transparent 40%, transparent), radial-gradient(circle at 0 150%, var(--portugal-blue) 24%, white 25%, white 28%, var(--portugal-blue) 29%, var(--portugal-blue) 36%, white 36%, white 40%, transparent 40%, transparent), radial-gradient(circle at 50% 100%, white 10%, var(--portugal-blue) 11%, var(--portugal-blue) 23%, white 24%, white 30%, var(--portugal-blue) 31%, var(--portugal-blue) 43%, white 44%, white 50%, var(--portugal-blue) 51%, var(--portugal-blue) 63%, white 64%, white 71%, transparent 71%, transparent), radial-gradient(circle at 100% 50%, white 5%, var(--portugal-blue) 6%, var(--portugal-blue) 15%, white 16%, white 20%, var(--portugal-blue) 21%, var(--portugal-blue) 30%, white 31%, white 35%, var(--portugal-blue) 36%, var(--portugal-blue) 45%, white 46%, white 49%, transparent 50%, transparent), radial-gradient(circle at 0 50%, white 5%, var(--portugal-blue) 6%, var(--portugal-blue) 15%, white 16%, white 20%, var(--portugal-blue) 21%, var(--portugal-blue) 30%, white 31%, white 35%, var(--portugal-blue) 36%, var(--portugal-blue) 45%, white 46%, white 49%, transparent 50%, transparent);
            background-size: 50px 50px;
            background-blend-mode: soft-light;
        }

        /* ä¸€èˆ¬å¡ç‰‡æ¨£å¼ */
        .card-portugal { border-left: 5px solid var(--portugal-blue); transition: all 0.2s ease; }
        .card-portugal:active { transform: scale(0.98); }

        /* --- é€£ç’°ç•«å°ˆå±¬æ¨£å¼ (Comic Style) --- */
        .comic-panel {
            border: var(--comic-border);
            box-shadow: var(--comic-shadow);
            background: #fff;
            transition: transform 0.2s;
        }
        .comic-panel:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #000;}
        .comic-caption-box {
            background: #fff;
            border-top: var(--comic-border);
            padding: 8px;
            text-align: center;
            font-weight: bold;
        }
        .comic-img-filter { filter: sepia(0.3) contrast(1.1); transition: filter 0.3s;}
        .comic-panel:hover .comic-img-filter { filter: sepia(0) contrast(1); }
        .comic-day-badge {
            position: absolute; top: -10px; left: -10px;
            background: #FFD700; border: 2px solid #000;
            padding: 2px 8px; font-weight: bold; transform: rotate(-5deg);
            box-shadow: 2px 2px 0 #000; z-index: 10;
        }

        /* å…¶ä»–æ¨£å¼ */
        .timeline-line { position: absolute; left: 24px; top: 45px; bottom: -20px; width: 3px; background: repeating-linear-gradient(to bottom, #cbd5e1 0, #cbd5e1 6px, transparent 6px, transparent 12px); z-index: 0; }
        .last-item .timeline-line { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .modal { transition: opacity 0.3s ease, transform 0.3s ease; }
        .modal.hidden { pointer-events: none; opacity: 0; transform: scale(0.95); }
        .modal.flex { pointer-events: auto; opacity: 1; transform: scale(1); }
        #map { height: calc(100vh - 180px); width: 100%; border-radius: 12px; border: 4px solid white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body>

    <header class="bg-azulejos text-white p-6 sticky top-0 z-50 shadow-lg rounded-b-[2rem] border-b-4 border-yellow-400">
        <div class="flex justify-between items-start mb-4">
            <div>
                <p class="text-xs uppercase tracking-widest opacity-90 mb-1">DECEMBER 13-15</p>
                <h1 class="text-3xl font-bold tracking-wide leading-tight">Macau<br>Adventure</h1>
            </div>
            <div class="flex flex-col items-end gap-2">
                <div class="text-right bg-white/10 backdrop-blur-sm px-3 py-1 rounded-lg">
                    <div id="weather-icon" class="text-xl inline-block mr-1"><i class="fas fa-spinner fa-spin"></i></div>
                    <span id="weather-temp" class="text-sm font-bold">--Â°C</span>
                </div>
                <button onclick="openTipsModal()" class="bg-yellow-400 text-blue-900 px-3 py-1 rounded-full text-xs font-bold shadow-md hover:bg-yellow-300 transition flex items-center">
                    <i class="fas fa-lightbulb mr-1"></i> æ—…è¡Œè²¼å£«
                </button>
            </div>
        </div>
    </header>

    <main class="p-4 relative max-w-md mx-auto">
        
        <div id="view-day1" class="tab-view block">
            <div class="flex items-center mb-6 mt-2">
                <span class="text-4xl font-bold text-blue-800 mr-2 serif-font">01</span>
                <div><h2 class="text-lg font-bold text-gray-800">æ­·å²åŸå€æ¼«æ­¥</h2><p class="text-xs text-gray-500">12æœˆ13æ—¥ â€¢ ä½å®¿ï¼šåå…­æµ¦ç´¢è²ç‰¹</p></div>
            </div>
            <div id="timeline-day1"></div>
        </div>

        <div id="view-day2" class="tab-view hidden">
            <div class="flex items-center mb-6 mt-2">
                <span class="text-4xl font-bold text-blue-800 mr-2 serif-font">02</span>
                <div><h2 class="text-lg font-bold text-gray-800">å¥¢è¯è·¯æ°¹é«”é©—</h2><p class="text-xs text-gray-500">12æœˆ14æ—¥ â€¢ ä½å®¿ï¼šæ¾³é–€ç‘å‰é…’åº—</p></div>
            </div>
            <div id="timeline-day2"></div>
        </div>

        <div id="view-day3" class="tab-view hidden">
            <div class="flex items-center mb-6 mt-2">
                <span class="text-4xl font-bold text-blue-800 mr-2 serif-font">03</span>
                <div><h2 class="text-lg font-bold text-gray-800">æ‚ é–’è³¼ç‰©è³¦æ­¸</h2><p class="text-xs text-gray-500">12æœˆ15æ—¥ â€¢ è¿”ç¨‹</p></div>
            </div>
            <div id="timeline-day3"></div>
        </div>

        <div id="view-map" class="tab-view hidden">
            <h2 class="text-xl font-bold text-blue-800 mb-4 ml-2 serif-font">ç¸½è¡Œç¨‹åœ°åœ–</h2>
            <div id="map"></div>
        </div>

        <div id="view-comic" class="tab-view hidden px-2">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-bold text-blue-900 comic-font tracking-wider">THE MACAU COMIC</h2>
                <p class="text-xs text-gray-500 serif-font">æ—…ç¨‹ç²¾è¯ â€¢ é€£ç’°ç•«å›é¡§</p>
            </div>
            <div id="comic-container" class="space-y-8 pb-4">
                </div>
        </div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-[0_-8px_30px_rgba(0,0,0,0.1)] py-2 px-4 flex justify-between items-center z-40 text-gray-400 rounded-t-3xl border-t-2 border-gray-200 max-w-md mx-auto">
        <button onclick="switchTab('day1')" class="nav-btn text-blue-700 flex flex-col items-center w-1/5" data-target="day1">
            <i class="fas fa-archway text-lg mb-1"></i><span class="text-[9px] font-bold">Day 1</span>
        </button>
        <button onclick="switchTab('day2')" class="nav-btn flex flex-col items-center w-1/5" data-target="day2">
            <i class="fas fa-star text-lg mb-1"></i><span class="text-[9px] font-bold">Day 2</span>
        </button>
        <button onclick="switchTab('day3')" class="nav-btn flex flex-col items-center w-1/5" data-target="day3">
            <i class="fas fa-plane text-lg mb-1"></i><span class="text-[9px] font-bold">Day 3</span>
        </button>
        <button onclick="switchTab('comic')" class="nav-btn flex flex-col items-center w-1/5" data-target="comic">
            <i class="fas fa-book-open text-lg mb-1"></i><span class="text-[9px] font-bold">é€£ç’°ç•«</span>
        </button>
        <button onclick="switchTab('map')" class="nav-btn flex flex-col items-center w-1/5" data-target="map">
            <i class="fas fa-map-marked-alt text-lg mb-1"></i><span class="text-[9px] font-bold">åœ°åœ–</span>
        </button>
    </nav>

    <div id="info-modal" class="modal hidden fixed inset-0 bg-blue-900/80 z-[60] flex items-end sm:items-center justify-center sm:p-4 backdrop-blur-sm" onclick="if(event.target === this) closeModal()">
        <div class="bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-sm overflow-hidden shadow-2xl h-[85vh] sm:h-auto flex flex-col">
            <div class="relative h-48 bg-gray-200">
                <img id="modal-image" src="" alt="Place" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                <button onclick="closeModal()" class="absolute top-4 right-4 bg-black/30 hover:bg-black/50 text-white rounded-full w-8 h-8 flex items-center justify-center backdrop-blur-md"><i class="fas fa-times"></i></button>
                <div class="absolute bottom-4 left-6 text-white">
                    <span id="modal-tag" class="bg-yellow-400 text-blue-900 text-[10px] font-bold px-2 py-0.5 rounded uppercase mb-1 inline-block">Spot</span>
                    <h3 id="modal-title" class="font-bold text-2xl serif-font text-shadow">æ¨™é¡Œ</h3>
                </div>
            </div>
            <div class="p-6 overflow-y-auto no-scrollbar flex-grow">
                <div id="modal-highlight" class="hidden bg-blue-50 border border-blue-100 rounded-lg p-3 mb-4 flex items-start">
                    <i class="fas fa-ticket-alt text-blue-600 mt-1 mr-3"></i>
                    <div><p class="text-xs text-blue-500 font-bold uppercase">Booking / Info</p><div id="modal-highlight-content" class="text-sm font-bold text-gray-800"></div></div>
                </div>
                <div class="flex items-center mb-4 text-sm text-gray-600"><i class="far fa-clock w-5 text-center mr-2 text-blue-600"></i><span id="modal-hours"></span></div>
                <div class="flex items-center mb-4 text-sm text-gray-600"><i class="fas fa-map-pin w-5 text-center mr-2 text-red-500"></i><span id="modal-address"></span></div>
                <div class="prose prose-sm text-gray-600 leading-relaxed"><p id="modal-desc"></p></div>
                <div id="modal-veg" class="hidden mt-4 p-3 bg-green-50 rounded-lg border border-green-100 text-xs text-green-800"><i class="fas fa-seedling mr-1"></i> <strong>ç´ é£Ÿæç¤ºï¼š</strong> <span id="modal-veg-content"></span></div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-gray-50">
                <a id="modal-map-btn" href="#" target="_blank" class="block w-full bg-blue-600 hover:bg-blue-700 text-white text-center py-3 rounded-xl font-bold shadow-lg transition transform active:scale-95"><i class="fas fa-location-arrow mr-2"></i> é–‹å•Ÿå°èˆª</a>
            </div>
        </div>
    </div>

    <div id="tips-modal" class="modal hidden fixed inset-0 bg-black/80 z-[70] flex items-center justify-center p-6 backdrop-blur-sm" onclick="if(event.target === this) closeTipsModal()">
        <div class="bg-white rounded-2xl max-w-sm w-full p-6 relative shadow-2xl border-t-8 border-yellow-400">
            <button onclick="closeTipsModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
            <h3 class="text-2xl font-bold text-blue-900 mb-4 serif-font"><i class="fas fa-book-open mr-2"></i>æ—…è¡Œè²¼å£«</h3>
            <div class="space-y-4 max-h-[60vh] overflow-y-auto pr-2 no-scrollbar">
                <div class="flex items-start"><div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mr-3 flex-shrink-0"><i class="fas fa-passport"></i></div><div><h4 class="font-bold text-sm">å…¥å¢ƒ & è­‰ä»¶</h4><p class="text-xs text-gray-500 mt-1">å°ç£è­·ç…§å…ç°½è­‰å¯åœç•™30å¤©ã€‚</p></div></div>
                <div class="flex items-start"><div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 mr-3 flex-shrink-0"><i class="fas fa-coins"></i></div><div><h4 class="font-bold text-sm">è²¨å¹£ (MOP/HKD)</h4><p class="text-xs text-gray-500 mt-1">æ¾³é–€å¹£èˆ‡æ¸¯å¹£é€šç”¨ (1:1)ã€‚</p></div></div>
                <div class="flex items-start"><div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600 mr-3 flex-shrink-0"><i class="fas fa-plug"></i></div><div><h4 class="font-bold text-sm">é›»å£“ & æ’åº§</h4><p class="text-xs text-gray-500 mt-1">220Vï¼Œè‹±å¼ä¸‰è…³æ–¹æ’ (Gå‹)ã€‚</p></div></div>
                <div class="flex items-start"><div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-800 mr-3 flex-shrink-0"><i class="fas fa-leaf"></i></div><div><h4 class="font-bold text-sm">ç´ é£Ÿé»é¤</h4><p class="text-xs text-gray-500 mt-1">ç²µèªï¼šã€Œèµ°è‚‰ã€èµ°äº”è¾›ã€ã€‚</p></div></div>
            </div>
            <button onclick="closeTipsModal()" class="w-full bg-blue-600 text-white py-2 rounded-lg font-bold mt-6">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // --- 1. è³‡æ–™æ•¸æ“š (æ›´æ–°äº†åœ–ç‰‡ Placeholder çš„æ–‡å­—ä»¥ç¬¦åˆé€£ç’°ç•«ä¸»é¡Œ) ---
        const scheduleData = {
            day1: [
                { time: "09:30", type: "flight", title: "æ¾³é–€èˆªç©º NX631", desc: "TPE âœˆï¸ MFM", icon: "fa-plane-departure", modal: { tag: "Flight", title: "NX631 å•Ÿç¨‹", desc: "æœŸå¾…å·²ä¹…çš„æ¾³é–€ä¹‹æ—…æ­£å¼é–‹å§‹ï¼", hours: "09:30 - 11:30", address: "æ¡ƒåœ’æ©Ÿå ´ T1", highlight: "é›»å­æ©Ÿç¥¨è™Ÿç¢¼ï¼š675-xxxxxxx", img: "https://placehold.co/600x400/005DC7/FFF?text=Takeoff+Adventure", link: "#" } },
                { time: "12:00", type: "hotel", title: "åå…­æµ¦ç´¢è²ç‰¹", desc: "å¯„æ”¾è¡Œæ / è¾¦ç†å…¥ä½", icon: "fa-hotel", modal: { tag: "Hotel", title: "æŠµé”ç´¢è²ç‰¹", desc: "ä½æ–¼å…§æ¸¯æ­·å²å€ï¼Œèåˆæ³•å¼èˆ‡æ¾³é–€é¢¨æƒ…ã€‚", hours: "Check-in: 15:00", address: "æ¾³é–€å…§æ¸¯", highlight: "é å®šä»£è™Ÿï¼šPMZSBJQK", img: "https://placehold.co/600x400/D4AF37/FFF?text=Sofitel+Ponte+16", link: "https://goo.gl/maps/sofitel" } },
                { time: "13:00", type: "food", title: "ç¥¥è¨˜éºªå®¶", desc: "ç±³å…¶æ—æ¨è–¦ï¼šè¦ç±½æ’ˆéºµ", icon: "fa-utensils", modal: { tag: "Lunch", title: "ç¥¥è¨˜ç«¹æ˜‡éºµ", desc: "äº”åå¹´è€å­—è™Ÿï¼Œçˆ½å½ˆçš„è¦ç±½æ’ˆéºµä»¤äººé›£å¿˜ã€‚", hours: "11:30 - 00:00", address: "ç¦éš†æ–°è¡—", veg: "å¯é»æ·¨éºµã€ç¼èœ(èµ°è ”æ²¹)ã€‚", img: "https://placehold.co/600x400/e53e3e/FFF?text=Classic+Noodles", link: "https://goo.gl/maps/xiangji" } },
                { time: "14:30", type: "sight", title: "å¤§ä¸‰å·´ç‰ŒåŠ", desc: "ä¸–ç•Œéºç”¢æ­·å²åŸå€", icon: "fa-archway", modal: { tag: "Must Visit", title: "å¤§ä¸‰å·´ç‰ŒåŠ", desc: "æ¾³é–€æœ€ç¶“å…¸çš„åœ°æ¨™ï¼Œè–ä¿ç¥¿æ•™å ‚çš„å‰å£éºè·¡ã€‚", hours: "å…¨å¤©é–‹æ”¾", address: "å¤§ä¸‰å·´æ–œå··", img: "https://placehold.co/600x400/4a5568/FFF?text=Ruins+of+St.Paul+Iconic+View", link: "https://goo.gl/maps/ruins" } },
                { time: "19:00", type: "food", title: "JWè¬è±ª åå»šéƒ½åŒ¯", desc: "è±ªè¯è‡ªåŠ©æ™šé¤", icon: "fa-wine-glass", modal: { tag: "Dinner", title: "åå»šéƒ½åŒ¯ç››å®´", desc: "åœ¨JWè¬è±ªäº«å—è±ç››çš„åœ‹éš›ç¾é£Ÿè‡ªåŠ©é¤ã€‚", hours: "18:00 - 21:30", address: "JWè¬è±ªé…’åº—", highlight: "å·²è¨‚ä½ï¼š19:00", veg: "æœ‰ç´ é£Ÿå°ˆå€ã€‚", img: "https://placehold.co/600x400/2d3748/FFF?text=Grand+Buffet+Dinner", link: "https://goo.gl/maps/jwmarriott" } },
            ],
            day2: [
                { time: "12:00", type: "food", title: "å°é£›è±¡è‘¡åœ‹é¤", desc: "ç¶“å…¸è‘¡å¼æ–™ç†", icon: "fa-utensils", modal: { tag: "Lunch", title: "è‘¡åœ‹èœé«”é©—", desc: "åœ¨æ°¹ä»”å“åšé“åœ°çš„æ”¹è‰¯å¼è‘¡åœ‹æ–™ç†ã€‚", hours: "11:45 - 23:00", address: "æ°¹ä»”åœ°å ¡è¡—", veg: "å¯å®¢è£½ç´ é£Ÿã€‚", img: "https://placehold.co/600x400/ed8936/FFF?text=Portuguese+Feast", link: "https://goo.gl/maps/dumbo" } },
                { time: "14:30", type: "sight", title: "é¾ç’°è‘¡éŸ»", desc: "è‘¡å¼ä½å®…åšç‰©é¤¨", icon: "fa-home", modal: { tag: "Culture", title: "é¾ç’°è‘¡éŸ»æ¼«æ­¥", desc: "è–„è·ç¶ çš„è‘¡å¼åˆ¥å¢…ç¾¤ï¼Œå……æ»¿æµªæ¼«æ°£æ¯ã€‚", hours: "10:00 - 19:00", address: "æ°¹ä»”æµ·é‚Šé¦¬è·¯", img: "https://placehold.co/600x400/38a169/FFF?text=Macanese+Houses", link: "https://goo.gl/maps/taipahouses" } },
                { time: "17:00", type: "hotel", title: "æ¾³é–€ç‘å‰é…’åº—", desc: "Check-in & ç®¡å®¶æœå‹™", icon: "fa-bed", modal: { tag: "Luxury Hotel", title: "å…¥ä½ç‘å‰é…’åº—", desc: "é«”é©—æ¥µè‡´å¥¢è¯çš„ç®¡å®¶æœå‹™èˆ‡è·¯æ°¹æ™¯è§€ã€‚", hours: "Check-in: 15:00", address: "è·¯æ°¹é€£è²«å…¬è·¯", highlight: "é å®šä»£è™Ÿï¼š81555809", img: "https://placehold.co/600x400/2b6cb0/FFF?text=St.Regis+Luxury", link: "https://goo.gl/maps/stregis" } },
            ],
            day3: [
                { time: "13:00", type: "food", title: "Passion by GD", desc: "æ³•å¼è¼•é£Ÿåˆé¤", icon: "fa-bread-slice", modal: { tag: "Light Meal", title: "æ³•å¼è¼•é£Ÿæ™‚å…‰", desc: "åœ¨éŠ€æ²³äº«å—ç²¾ç·»çš„æ³•å¼éºµåŒ…èˆ‡ç”œé»ã€‚", hours: "10:00 - 22:00", address: "æ¾³é–€éŠ€æ²³", veg: "æœ‰ç´ é£Ÿä¸‰æ˜æ²»/æ²™æ‹‰ã€‚", img: "https://placehold.co/600x400/d69e2e/FFF?text=French+Bakery+Cafe", link: "https://goo.gl/maps/galaxy" } },
                { time: "17:30", type: "flight", title: "æ¾³é–€èˆªç©º NX618", desc: "MFM âœˆï¸ TPE", icon: "fa-plane-departure", modal: { tag: "Return Flight", title: "æ»¿è¼‰è€Œæ­¸", desc: "çµæŸç¾å¥½çš„æ¾³é–€ä¹‹æ—…ï¼Œæ­æ©Ÿè¿”å°ã€‚", hours: "17:30 èµ·é£›", address: "æ¾³é–€åœ‹éš›æ©Ÿå ´", img: "https://placehold.co/600x400/005DC7/FFF?text=Journey+Home", link: "https://www.macau-airport.com/" } }
            ]
        };

        const mapLocations = [
            { lat: 22.196, lng: 113.536, title: "åå…­æµ¦ç´¢è²ç‰¹", day: "D1" },
            { lat: 22.194, lng: 113.539, title: "ç¥¥è¨˜éºªå®¶", day: "D1" },
            { lat: 22.197, lng: 113.540, title: "å¤§ä¸‰å·´ç‰ŒåŠ", day: "D1" },
            { lat: 22.149, lng: 113.553, title: "JWè¬è±ª", day: "D1" },
            { lat: 22.146, lng: 113.556, title: "æ¾³é–€ç‘å‰", day: "D2" },
            { lat: 22.153, lng: 113.556, title: "å°é£›è±¡", day: "D2" },
            { lat: 22.151, lng: 113.554, title: "é¾ç’°è‘¡éŸ»", day: "D2" },
            { lat: 22.158, lng: 113.565, title: "æ¾³é–€æ©Ÿå ´", day: "D3" }
        ];

        // --- 2. æ¸²æŸ“é‚è¼¯ ---
        function renderTimeline(dayId, data) {
            const container = document.getElementById(`timeline-${dayId}`);
            let html = '';
            data.forEach((item, index) => {
                const isLast = index === data.length - 1;
                const modalStr = encodeURIComponent(JSON.stringify(item.modal));
                html += `
                    <div class="flex relative mb-8 ${isLast ? 'last-item' : ''}" onclick="openModal('${modalStr}')">
                        <div class="w-14 text-right pr-3 pt-2 flex-shrink-0 z-10"><span class="text-sm font-bold text-gray-500 font-mono">${item.time}</span></div>
                        <div class="relative flex flex-col items-center mr-4 z-10">
                            <div class="w-10 h-10 rounded-full bg-white border-2 border-blue-500 shadow-md flex items-center justify-center text-blue-600 z-20"><i class="fas ${item.icon}"></i></div>
                            <div class="timeline-line"></div>
                        </div>
                        <div class="card-portugal bg-white p-4 rounded-r-xl rounded-bl-xl shadow-sm flex-grow cursor-pointer relative overflow-hidden group">
                            <div class="absolute right-0 top-0 bottom-0 w-16 opacity-10 group-hover:opacity-20 transition"><img src="${item.modal.img}" class="w-full h-full object-cover grayscale"></div>
                            <div class="relative z-10"><h3 class="font-bold text-gray-800 text-lg mb-1 group-hover:text-blue-700 transition">${item.title}</h3><p class="text-xs text-gray-500 mb-2">${item.desc}</p><span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-1 rounded border border-blue-100"><i class="fas fa-info-circle mr-1"></i>é»æ“ŠæŸ¥çœ‹è©³æƒ…</span></div>
                        </div>
                    </div>`;
            });
            container.innerHTML = html;
        }

        // ğŸ”¥ æ–°å¢ï¼šæ¸²æŸ“é€£ç’°ç•« (Comic Strip Renderer)
        function renderComic() {
            const container = document.getElementById('comic-container');
            let html = '';
            // æŒ‘é¸é‡é»è¡Œç¨‹è£½ä½œæˆé€£ç’°ç•«
            const highlights = [
                { day: "Day 1", ...scheduleData.day1[0] }, // å•Ÿç¨‹
                { day: "Day 1", ...scheduleData.day1[3] }, // å¤§ä¸‰å·´
                { day: "Day 1", ...scheduleData.day1[4] }, // æ™šé¤
                { day: "Day 2", ...scheduleData.day2[1] }, // é¾ç’°è‘¡éŸ»
                { day: "Day 2", ...scheduleData.day2[2] }, // ç‘å‰é…’åº—
                { day: "Day 3", ...scheduleData.day3[1] }  // è¿”ç¨‹
            ];

            highlights.forEach((item, index) => {
                // æ¼«ç•«é¢¨æ ¼é¢æ¿
                html += `
                <div class="comic-panel relative p-2 bg-white transform rotate-${index % 2 === 0 ? '1' : '-1'} hover:rotate-0 transition duration-300 z-10">
                    <div class="comic-day-badge comic-font text-sm">${item.day}</div>
                    <div class="relative border-2 border-black overflow-hidden h-48 bg-gray-200">
                        <img src="${item.modal.img}" class="w-full h-full object-cover comic-img-filter">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent pointer-events-none"></div>
                    </div>
                    <div class="comic-caption-box mt-2">
                        <h3 class="text-lg font-bold text-blue-900 serif-font leading-tight">${item.modal.title}</h3>
                        <p class="text-xs text-gray-600 comic-font mt-1 uppercase tracking-wider">${item.desc}</p>
                    </div>
                </div>
                `;
                // åŠ å…¥é€£æ¥ç®­é ­ (é™¤äº†æœ€å¾Œä¸€å€‹)
                if (index < highlights.length - 1) {
                    html += `<div class="flex justify-center py-2"><i class="fas fa-arrow-down text-3xl text-yellow-500 animate-bounce" style="filter: drop-shadow(2px 2px 0 #000);"></i></div>`;
                }
            });
            container.innerHTML = html;
        }

        // --- 3. äº’å‹•åŠŸèƒ½ ---
        document.addEventListener("DOMContentLoaded", () => {
            renderTimeline('day1', scheduleData.day1);
            renderTimeline('day2', scheduleData.day2);
            renderTimeline('day3', scheduleData.day3);
            renderComic(); // åˆå§‹åŒ–é€£ç’°ç•«
            fetchWeather();
        });

        function switchTab(targetId) {
            document.querySelectorAll('.tab-view').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${targetId}`).classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            document.querySelectorAll('.nav-btn').forEach(btn => {
                if(btn.dataset.target === targetId) {
                    btn.classList.add('text-blue-700', 'scale-110');
                    btn.classList.remove('text-gray-400');
                } else {
                    btn.classList.remove('text-blue-700', 'scale-110');
                    btn.classList.add('text-gray-400');
                }
            });
            if (targetId === 'map') setTimeout(initMap, 200);
        }

        // Modals (ä¿æŒä¸è®Š)
        function openModal(dataStr) {
            const data = JSON.parse(decodeURIComponent(dataStr));
            document.getElementById('modal-title').innerText = data.title;
            document.getElementById('modal-tag').innerText = data.tag;
            document.getElementById('modal-desc').innerText = data.desc;
            document.getElementById('modal-hours').innerText = data.hours || "ä¾ç¾å ´ç‚ºæº–";
            document.getElementById('modal-address').innerText = data.address;
            document.getElementById('modal-image').src = data.img;
            document.getElementById('modal-map-btn').href = data.link;
            
            const highlightEl = document.getElementById('modal-highlight');
            if(data.highlight) { highlightEl.classList.remove('hidden'); document.getElementById('modal-highlight-content').innerText = data.highlight; } else { highlightEl.classList.add('hidden'); }
            
            const vegEl = document.getElementById('modal-veg');
            if(data.veg) { vegEl.classList.remove('hidden'); document.getElementById('modal-veg-content').innerText = data.veg; } else { vegEl.classList.add('hidden'); }

            document.getElementById('info-modal').classList.remove('hidden');
            document.getElementById('info-modal').classList.add('flex');
        }
        function closeModal() { document.getElementById('info-modal').classList.add('hidden'); document.getElementById('info-modal').classList.remove('flex'); }
        function openTipsModal() { document.getElementById('tips-modal').classList.remove('hidden'); document.getElementById('tips-modal').classList.add('flex'); }
        function closeTipsModal() { document.getElementById('tips-modal').classList.add('hidden'); document.getElementById('tips-modal').classList.remove('flex'); }

        // å¤©æ°£
        async function fetchWeather() {
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=22.1987&longitude=113.5439&current_weather=true');
                const data = await res.json();
                const temp = Math.round(data.current_weather.temperature);
                document.getElementById('weather-temp').innerText = `${temp}Â°C`;
                document.getElementById('weather-icon').innerHTML = temp > 20 ? '<i class="fas fa-sun text-yellow-400"></i>' : '<i class="fas fa-cloud text-gray-200"></i>';
            } catch (e) { document.getElementById('weather-temp').innerText = "18Â°C"; }
        }

        // åœ°åœ–
        let map;
        function initMap() {
            if (map) return;
            map = L.map('map').setView([22.16, 113.55], 12);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: '&copy; OpenStreetMap', maxZoom: 20 }).addTo(map);
            mapLocations.forEach((loc, index) => {
                const iconHtml = `<div class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold border-2 border-white shadow-lg font-mono">${index + 1}</div>`;
                const customIcon = L.divIcon({ html: iconHtml, className: 'custom-div-icon', iconSize: [32, 32], iconAnchor: [16, 16] });
                L.marker([loc.lat, loc.lng], {icon: customIcon}).addTo(map).bindPopup(`<b class="text-blue-800">${loc.title}</b><br><span class="text-xs text-gray-500">${loc.day}</span>`);
            });
        }
    </script>
</body>
</html>