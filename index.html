<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>澳門 3 天 2 夜特色美食之旅</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        /* 自定義樣式補充 */
        body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background-color: #f3f4f6; padding-bottom: 80px; }
        
        /* 時間軸線條效果 */
        .timeline-line {
            position: absolute;
            left: 24px;
            top: 40px;
            bottom: -20px;
            width: 2px;
            background-color: #e5e7eb;
            z-index: 0;
        }
        .last-item .timeline-line { display: none; }

        /* 隱藏滾動條但保留功能 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Modal 動畫 */
        .modal { transition: opacity 0.3s ease; }
        .modal.hidden { pointer-events: none; opacity: 0; }
        .modal.flex { pointer-events: auto; opacity: 1; }
        
        /* 互動關鍵字樣式 */
        .interactive-link {
            color: #2563eb;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 1px dashed #2563eb;
        }

        /* 地圖容器高度 */
        #map { height: calc(100vh - 160px); width: 100%; border-radius: 12px; }
    </style>
</head>
<body>

    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-6 sticky top-0 z-50 shadow-md rounded-b-3xl">
        <div class="flex justify-between items-center mb-2">
            <div>
                <p class="text-sm opacity-80" id="current-date">12月13日 (五)</p>
                <h1 class="text-2xl font-bold">澳門特色美食之旅</h1>
            </div>
            <div class="text-right">
                <div id="weather-icon" class="text-2xl"><i class="fas fa-spinner fa-spin"></i></div>
                <div id="weather-temp" class="text-sm font-medium">載入中...</div>
            </div>
        </div>
        <div class="flex items-center text-xs opacity-90 space-x-2">
            <span class="bg-white/20 px-2 py-1 rounded-full"><i class="fas fa-map-marker-alt mr-1"></i>澳門半島 / 路氹</span>
        </div>
    </header>

    <main class="p-4 relative">
        
        <div id="view-day1" class="tab-view block">
            <h2 class="text-gray-500 font-bold mb-4 ml-2">Day 1: 歷史與葡式風情</h2>
            <div id="timeline-day1">
                </div>
        </div>

        <div id="view-day2" class="tab-view hidden">
            <h2 class="text-gray-500 font-bold mb-4 ml-2">Day 2: 奢華路氹體驗</h2>
            <div id="timeline-day2">
                </div>
        </div>

        <div id="view-day3" class="tab-view hidden">
            <h2 class="text-gray-500 font-bold mb-4 ml-2">Day 3: 悠閒賦歸</h2>
            <div id="timeline-day3">
                </div>
        </div>

        <div id="view-map" class="tab-view hidden">
            <h2 class="text-gray-500 font-bold mb-4 ml-2">總行程地圖</h2>
            <div class="bg-white p-1 rounded-2xl shadow-lg">
                <div id="map"></div>
            </div>
        </div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] py-2 px-6 flex justify-between items-center z-50 text-gray-400 rounded-t-2xl">
        <button onclick="switchTab('day1')" class="nav-btn text-blue-600 flex flex-col items-center" data-target="day1">
            <i class="fas fa-calendar-day text-xl mb-1"></i>
            <span class="text-[10px] font-bold">Day 1</span>
        </button>
        <button onclick="switchTab('day2')" class="nav-btn flex flex-col items-center" data-target="day2">
            <i class="fas fa-calendar-day text-xl mb-1"></i>
            <span class="text-[10px] font-bold">Day 2</span>
        </button>
        <button onclick="switchTab('day3')" class="nav-btn flex flex-col items-center" data-target="day3">
            <i class="fas fa-plane-departure text-xl mb-1"></i>
            <span class="text-[10px] font-bold">Day 3</span>
        </button>
        <button onclick="switchTab('map')" class="nav-btn flex flex-col items-center" data-target="map">
            <i class="fas fa-map-marked-alt text-xl mb-1"></i>
            <span class="text-[10px] font-bold">地圖</span>
        </button>
    </nav>

    <div id="info-modal" class="modal hidden fixed inset-0 bg-black/60 z-[60] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-sm overflow-hidden shadow-2xl transform transition-all scale-100">
            <div class="bg-indigo-600 p-4 flex justify-between items-center text-white">
                <h3 id="modal-title" class="font-bold text-lg">標題</h3>
                <button onclick="closeModal()" class="text-white hover:text-gray-200"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <div id="modal-content" class="text-gray-700 mb-4">內容...</div>
                <img id="modal-image" src="" alt="Info" class="w-full rounded-lg mb-4 hidden object-cover h-40">
                <button onclick="closeModal()" class="w-full bg-indigo-600 text-white py-2 rounded-lg font-bold">關閉</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // --- 1. 資料數據 (Data) ---
        const scheduleData = {
            day1: [
                { time: "09:30", type: "flight", title: "澳門航空 NX631", desc: "台北 TPE ➔ 澳門 MFM", icon: "fa-plane", interactive: "航班資訊", modalData: {title:"航班資訊", content:"航班：NX631<br>起飛：09:30 TPE<br>抵達：11:30 MFM<br>航廈：T1", img:"https://placehold.co/600x400/2563eb/white?text=E-Ticket+NX631"} },
                { time: "11:30", type: "transport", title: "抵達 & 前往酒店", desc: "搭乘計程車或接駁車", icon: "fa-taxi", link: "https://goo.gl/maps/macauAirport" },
                { time: "12:00", type: "hotel", title: "十六浦索菲特 (寄放)", desc: "辦理入住手續或寄放行李", icon: "fa-suitcase", interactive: "訂房代號", modalData: {title:"住宿資訊", content:"澳門十六浦索菲特<br>訂單號：SOF-88821<br>電話：+853 8861 0016", img:"https://placehold.co/600x400/eab308/white?text=Hotel+Confirm"} },
                { time: "13:00", type: "food", title: "祥記麪家 (午餐)", desc: "推薦：蝦籽撈麵 (素食可點淨麵)", icon: "fa-utensils", link: "https://www.google.com/maps/search/?api=1&query=祥記麪家+澳門" },
                { time: "14:30", type: "sight", title: "世界遺產漫步", desc: "議事亭前地 ➔ 大三巴", icon: "fa-camera", link: "https://www.google.com/maps/search/?api=1&query=大三巴牌坊" },
                { time: "19:00", type: "food", title: "JW萬豪 名廚都匯", desc: "豪華自助晚餐 (已預訂)", icon: "fa-wine-glass", interactive: "訂位資訊", modalData: {title:"餐廳訂位", content:"名廚都匯 Urban Kitchen<br>時間：19:00<br>人數：1人<br>備註：素食友善", img:"https://placehold.co/600x400/dc2626/white?text=Buffet+Booking"} },
            ],
            day2: [
                { time: "10:30", type: "transport", title: "前往瑞吉酒店", desc: "退房並移動至路氹", icon: "fa-car", link: "https://www.google.com/maps/search/?api=1&query=澳門瑞吉酒店" },
                { time: "12:00", type: "food", title: "小飛象葡國餐", desc: "正選午餐 (或素悅)", icon: "fa-utensils", link: "https://www.google.com/maps/search/?api=1&query=小飛象葡國餐" },
                { time: "14:30", type: "sight", title: "氹仔舊城區", desc: "官也街、龍環葡韻", icon: "fa-walking", link: "https://www.google.com/maps/search/?api=1&query=官也街" },
                { time: "17:00", type: "hotel", title: "澳門瑞吉酒店 Check-in", desc: "享受管家服務", icon: "fa-bed", interactive: "訂房資訊", modalData: {title:"住宿資訊", content:"澳門瑞吉酒店<br>訂單號：STR-99901<br>房型：豪華客房", img:"https://placehold.co/600x400/4f46e5/white?text=St.Regis+Confirm"} },
                { time: "19:30", type: "food", title: "瑞吉 The Manor", desc: "精緻晚餐饗宴", icon: "fa-utensils", link: "https://www.google.com/maps/search/?api=1&query=The+Manor+Macau" }
            ],
            day3: [
                { time: "09:00", type: "relax", title: "悠閒早晨", desc: "酒店設施體驗", icon: "fa-coffee" },
                { time: "12:00", type: "hotel", title: "退房", desc: "準備前往午餐", icon: "fa-concierge-bell" },
                { time: "13:00", type: "food", title: "Passion by GD", desc: "輕食午餐 (銀河)", icon: "fa-bread-slice", link: "https://www.google.com/maps/search/?api=1&query=Passion+by+Gerard+Dubois+Galaxy" },
                { time: "16:00", type: "transport", title: "前往機場", desc: "搭乘接駁車或計程車", icon: "fa-bus", link: "https://goo.gl/maps/macauAirport" },
                { time: "17:30", type: "flight", title: "澳門航空 NX618", desc: "澳門 MFM ➔ 台北 TPE", icon: "fa-plane-departure", interactive: "回程機票", modalData: {title:"航班資訊", content:"航班：NX618<br>起飛：17:30 MFM<br>抵達：19:15 TPE", img:"https://placehold.co/600x400/2563eb/white?text=E-Ticket+NX618"} }
            ]
        };

        // 地圖座標數據
        const mapLocations = [
            { lat: 22.196, lng: 113.536, title: "十六浦索菲特", day: "D1", type: "hotel" },
            { lat: 22.194, lng: 113.539, title: "祥記麪家", day: "D1", type: "food" },
            { lat: 22.197, lng: 113.540, title: "大三巴牌坊", day: "D1", type: "sight" },
            { lat: 22.149, lng: 113.553, title: "JW萬豪酒店", day: "D1", type: "food" },
            { lat: 22.146, lng: 113.556, title: "澳門瑞吉酒店", day: "D2", type: "hotel" },
            { lat: 22.153, lng: 113.556, title: "小飛象葡國餐", day: "D2", type: "food" },
            { lat: 22.151, lng: 113.554, title: "官也街", day: "D2", type: "sight" },
            { lat: 22.148, lng: 113.554, title: "Passion by GD", day: "D3", type: "food" },
            { lat: 22.158, lng: 113.565, title: "澳門機場", day: "D3", type: "transport" }
        ];

        // --- 2. 渲染函式 (Rendering) ---
        
        function renderTimeline(dayId, data) {
            const container = document.getElementById(`timeline-${dayId}`);
            let html = '';
            
            data.forEach((item, index) => {
                const isLast = index === data.length - 1;
                
                // 處理 Modal 觸發
                let interactiveHtml = '';
                if (item.interactive) {
                    // 將物件轉換為字串存入 data attribute (簡單處理)
                    const modalStr = encodeURIComponent(JSON.stringify(item.modalData));
                    interactiveHtml = `<span class="interactive-link ml-2 text-xs" onclick="openModal('${modalStr}')"><i class="fas fa-info-circle"></i> ${item.interactive}</span>`;
                }

                // 處理 Google Maps 連結
                let locationHtml = '';
                if (item.link) {
                    locationHtml = `<a href="${item.link}" target="_blank" class="text-gray-400 hover:text-blue-500 ml-auto"><i class="fas fa-location-arrow text-lg"></i></a>`;
                }

                html += `
                    <div class="flex relative mb-6 ${isLast ? 'last-item' : ''}">
                        <div class="w-16 text-right pr-3 pt-1 flex-shrink-0">
                            <span class="text-sm font-bold text-gray-700 block">${item.time}</span>
                        </div>
                        
                        <div class="relative flex flex-col items-center mr-3 z-10">
                            <div class="w-10 h-10 rounded-full bg-white border-2 border-indigo-100 shadow-sm flex items-center justify-center text-indigo-600">
                                <i class="fas ${item.icon}"></i>
                            </div>
                            <div class="timeline-line"></div>
                        </div>

                        <div class="bg-white p-4 rounded-xl shadow-sm flex-grow border border-gray-100 flex items-start">
                            <div class="flex-grow">
                                <h3 class="font-bold text-gray-800 text-base mb-1">
                                    ${item.title} 
                                    ${interactiveHtml}
                                </h3>
                                <p class="text-sm text-gray-500 leading-relaxed">${item.desc}</p>
                            </div>
                            ${locationHtml}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // --- 3. 邏輯互動 (Logic) ---

        // 初始化
        document.addEventListener("DOMContentLoaded", () => {
            renderTimeline('day1', scheduleData.day1);
            renderTimeline('day2', scheduleData.day2);
            renderTimeline('day3', scheduleData.day3);
            fetchWeather();
        });

        // 切換 Tab
        function switchTab(targetId) {
            // 隱藏所有 view
            document.querySelectorAll('.tab-view').forEach(el => el.classList.add('hidden'));
            // 顯示目標 view
            document.getElementById(`view-${targetId}`).classList.remove('hidden');
            
            // 更新按鈕狀態
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if(btn.dataset.target === targetId) {
                    btn.classList.add('text-blue-600');
                    btn.classList.remove('text-gray-400');
                } else {
                    btn.classList.remove('text-blue-600');
                    btn.classList.add('text-gray-400');
                }
            });

            // 如果切換到地圖，且地圖尚未初始化，則初始化
            if (targetId === 'map') {
                setTimeout(() => {
                    initMap();
                }, 100); // 延遲以確保容器可見
            }
        }

        // Modal 控制
        function openModal(dataStr) {
            const data = JSON.parse(decodeURIComponent(dataStr));
            document.getElementById('modal-title').innerText = data.title;
            document.getElementById('modal-content').innerHTML = data.content;
            
            const imgEl = document.getElementById('modal-image');
            if(data.img) {
                imgEl.src = data.img;
                imgEl.classList.remove('hidden');
            } else {
                imgEl.classList.add('hidden');
            }
            
            document.getElementById('info-modal').classList.remove('hidden');
            document.getElementById('info-modal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('info-modal').classList.add('hidden');
            document.getElementById('info-modal').classList.remove('flex');
        }

        // 氣象 API (Open-Meteo)
        async function fetchWeather() {
            try {
                // 澳門座標
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=22.1987&longitude=113.5439&current_weather=true');
                const data = await res.json();
                const temp = Math.round(data.current_weather.temperature);
                
                document.getElementById('weather-temp').innerText = `${temp}°C 舒適`;
                document.getElementById('weather-icon').innerHTML = '<i class="fas fa-sun text-yellow-400"></i>';
            } catch (e) {
                document.getElementById('weather-temp').innerText = "20°C (預設)";
            }
        }

        // 地圖初始化 (Leaflet)
        let map;
        function initMap() {
            if (map) return; // 避免重複初始化

            // 澳門中心點
            map = L.map('map').setView([22.17, 113.55], 13);

            // 使用 CartoDB Voyager (卡通/簡約風格)
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                subdomains: 'abcd',
                maxZoom: 20
            }).addTo(map);

            // 添加標記
            mapLocations.forEach((loc, index) => {
                const iconHtml = `<div class="bg-blue-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold border-2 border-white shadow-md">${index + 1}</div>`;
                
                const customIcon = L.divIcon({
                    html: iconHtml,
                    className: 'custom-div-icon',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                });

                const marker = L.marker([loc.lat, loc.lng], {icon: customIcon}).addTo(map);
                marker.bindPopup(`<b>${loc.day} - ${loc.title}</b><br><button class="text-blue-600 underline mt-1 text-xs" onclick="jumpToDay('${loc.day}')">查看行程</button>`);
            });
        }

        // 從地圖跳轉回行程
        window.jumpToDay = function(dayCode) {
            const dayMap = {'D1': 'day1', 'D2': 'day2', 'D3': 'day3'};
            switchTab(dayMap[dayCode]);
        }

    </script>
</body>
</html>