<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>澳門 6人美食之旅 2025</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        /* --- 葡式風情主題樣式 --- */
        :root {
            --portugal-blue: #005DC7;
            --portugal-white: #FFFFFF;
            --tile-bg: #F0F4F8;
        }

        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: var(--tile-bg); 
            padding-bottom: 90px; 
            color: #333;
        }

        h1, h2, h3, .serif-font {
            font-family: 'Playfair Display', serif;
        }

        .bg-azulejos {
            background-color: var(--portugal-blue);
            background-image: 
                radial-gradient(circle at 100% 150%, var(--portugal-blue) 24%, white 25%, white 28%, var(--portugal-blue) 29%, var(--portugal-blue) 36%, white 36%, white 40%, transparent 40%, transparent),
                radial-gradient(circle at 0    150%, var(--portugal-blue) 24%, white 25%, white 28%, var(--portugal-blue) 29%, var(--portugal-blue) 36%, white 36%, white 40%, transparent 40%, transparent),
                radial-gradient(circle at 50%  100%, white 10%, var(--portugal-blue) 11%, var(--portugal-blue) 23%, white 24%, white 30%, var(--portugal-blue) 31%, var(--portugal-blue) 43%, white 44%, white 50%, var(--portugal-blue) 51%, var(--portugal-blue) 63%, white 64%, white 71%, transparent 71%, transparent),
                radial-gradient(circle at 100% 50%, white 5%, var(--portugal-blue) 6%, var(--portugal-blue) 15%, white 16%, white 20%, var(--portugal-blue) 21%, var(--portugal-blue) 30%, white 31%, white 35%, var(--portugal-blue) 36%, var(--portugal-blue) 45%, white 46%, white 49%, transparent 50%, transparent),
                radial-gradient(circle at 0    50%, white 5%, var(--portugal-blue) 6%, var(--portugal-blue) 15%, white 16%, white 20%, var(--portugal-blue) 21%, var(--portugal-blue) 30%, white 31%, white 35%, var(--portugal-blue) 36%, var(--portugal-blue) 45%, white 46%, white 49%, transparent 50%, transparent);
            background-size: 50px 50px;
            background-blend-mode: soft-light;
        }

        .card-portugal {
            border-left: 5px solid var(--portugal-blue);
            transition: all 0.2s ease;
        }
        .card-portugal:active {
            transform: scale(0.98);
            background-color: #f8fafc;
        }

        .timeline-line {
            position: absolute;
            left: 24px;
            top: 45px;
            bottom: -20px;
            width: 3px;
            background: repeating-linear-gradient(to bottom, #cbd5e1 0, #cbd5e1 6px, transparent 6px, transparent 12px);
            z-index: 0;
        }
        .last-item .timeline-line { display: none; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .modal { transition: opacity 0.3s ease, transform 0.3s ease; }
        .modal.hidden { pointer-events: none; opacity: 0; transform: scale(0.95); }
        .modal.flex { pointer-events: auto; opacity: 1; transform: scale(1); }
        
        #map { height: calc(100vh - 180px); width: 100%; border-radius: 12px; border: 4px solid white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body>

    <header class="bg-azulejos text-white p-6 sticky top-0 z-50 shadow-lg rounded-b-[2rem] border-b-4 border-yellow-400">
        <div class="flex justify-between items-start mb-4">
            <div>
                <p class="text-xs uppercase tracking-widest opacity-90 mb-1" id="current-date">DEC 13 - 15, 2025</p>
                <h1 class="text-3xl font-bold tracking-wide leading-tight">Macau Trip<br><span class="text-xl font-normal opacity-90">6 Pax Group</span></h1>
            </div>
            <div class="flex flex-col items-end gap-2">
                <div class="text-right bg-white/10 backdrop-blur-sm px-3 py-1 rounded-lg">
                    <div id="weather-icon" class="text-xl inline-block mr-1"><i class="fas fa-spinner fa-spin"></i></div>
                    <span id="weather-temp" class="text-sm font-bold">--°C</span>
                </div>
                <button onclick="openTipsModal()" class="bg-yellow-400 text-blue-900 px-3 py-1 rounded-full text-xs font-bold shadow-md hover:bg-yellow-300 transition flex items-center">
                    <i class="fas fa-clipboard-list mr-1"></i> 行前/預訂
                </button>
            </div>
        </div>
        <div class="flex items-center text-xs font-medium space-x-3 mt-1 overflow-x-auto no-scrollbar">
            <span class="bg-white/20 px-2 py-1 rounded flex-shrink-0"><i class="fas fa-hotel mr-1"></i>索菲特</span>
            <span class="bg-white/20 px-2 py-1 rounded flex-shrink-0"><i class="fas fa-hotel mr-1"></i>瑞吉</span>
            <span class="bg-white/20 px-2 py-1 rounded flex-shrink-0"><i class="fas fa-leaf mr-1"></i>素食友善</span>
        </div>
    </header>

    <main class="p-4 relative max-w-md mx-auto">
        
        <div id="view-day1" class="tab-view block">
            <div class="flex items-center mb-6 mt-2">
                <span class="text-4xl font-bold text-blue-800 mr-2 serif-font">01</span>
                <div>
                    <h2 class="text-lg font-bold text-gray-800">內港風情與葡韻</h2>
                    <p class="text-xs text-gray-500">12/13 (六) • 宿：十六浦索菲特</p>
                </div>
            </div>
            <div id="timeline-day1"></div>
        </div>

        <div id="view-day2" class="tab-view hidden">
            <div class="flex items-center mb-6 mt-2">
                <span class="text-4xl font-bold text-blue-800 mr-2 serif-font">02</span>
                <div>
                    <h2 class="text-lg font-bold text-gray-800">美食分流與奢華</h2>
                    <p class="text-xs text-gray-500">12/14 (日) • 宿：澳門瑞吉</p>
                </div>
            </div>
            <div id="timeline-day2"></div>
        </div>

        <div id="view-day3" class="tab-view hidden">
            <div class="flex items-center mb-6 mt-2">
                <span class="text-4xl font-bold text-blue-800 mr-2 serif-font">03</span>
                <div>
                    <h2 class="text-lg font-bold text-gray-800">路環慢活與返台</h2>
                    <p class="text-xs text-gray-500">12/15 (一) • 返程</p>
                </div>
            </div>
            <div id="timeline-day3"></div>
        </div>

        <div id="view-illustration" class="tab-view hidden">
            <h2 class="text-xl font-bold text-blue-800 mb-4 ml-2 serif-font">行程手繪地圖</h2>
            <div class="bg-white p-2 rounded-2xl shadow-lg border-2 border-blue-100 overflow-hidden">
                <img src="https://raw.githubusercontent.com/skywindy0727/skywindy0727.github.io/refs/heads/main/Gemini_Generated_Image_ffkb37ffkb37ffkb.png" alt="澳門3天2夜手繪行程" class="w-full h-auto rounded-lg object-cover">
                <div class="p-3 text-center">
                    <p class="text-sm font-bold text-blue-900">Macau Trip Highlights</p>
                    <p class="text-xs text-gray-500 mt-1">Day 1 ~ Day 3 全程精華概覽</p>
                </div>
            </div>
        </div>

        <div id="view-map" class="tab-view hidden">
            <h2 class="text-xl font-bold text-blue-800 mb-4 ml-2 serif-font">總行程地圖</h2>
            <div id="map"></div>
        </div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-[0_-8px_30px_rgba(0,0,0,0.1)] py-3 px-4 flex justify-between items-center z-40 text-gray-400 rounded-t-3xl border-t border-gray-100 max-w-md mx-auto">
        <button onclick="switchTab('day1')" class="nav-btn text-blue-700 flex flex-col items-center transform transition active:scale-90" data-target="day1">
            <i class="fas fa-archway text-lg mb-1"></i>
            <span class="text-[9px] font-bold">D1 內港</span>
        </button>
        <button onclick="switchTab('day2')" class="nav-btn flex flex-col items-center transform transition active:scale-90" data-target="day2">
            <i class="fas fa-star text-lg mb-1"></i>
            <span class="text-[9px] font-bold">D2 路氹</span>
        </button>
        <button onclick="switchTab('day3')" class="nav-btn flex flex-col items-center transform transition active:scale-90" data-target="day3">
            <i class="fas fa-leaf text-lg mb-1"></i>
            <span class="text-[9px] font-bold">D3 路環</span>
        </button>
        <button onclick="switchTab('illustration')" class="nav-btn flex flex-col items-center transform transition active:scale-90" data-target="illustration">
            <i class="fas fa-palette text-lg mb-1"></i>
            <span class="text-[9px] font-bold">插畫</span>
        </button>
        <button onclick="switchTab('map')" class="nav-btn flex flex-col items-center transform transition active:scale-90" data-target="map">
            <i class="fas fa-map-marked-alt text-lg mb-1"></i>
            <span class="text-[9px] font-bold">地圖</span>
        </button>
    </nav>

    <div id="info-modal" class="modal hidden fixed inset-0 bg-blue-900/80 z-[60] flex items-end sm:items-center justify-center sm:p-4 backdrop-blur-sm" onclick="if(event.target === this) closeModal()">
        <div class="bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-sm overflow-hidden shadow-2xl h-[85vh] sm:h-auto flex flex-col">
            <div class="relative h-48 bg-gray-200">
                <img id="modal-image" src="" alt="Place" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                <button onclick="closeModal()" class="absolute top-4 right-4 bg-black/30 hover:bg-black/50 text-white rounded-full w-8 h-8 flex items-center justify-center backdrop-blur-md"><i class="fas fa-times"></i></button>
                <div class="absolute bottom-4 left-6 text-white">
                    <span id="modal-tag" class="bg-yellow-400 text-blue-900 text-[10px] font-bold px-2 py-0.5 rounded uppercase mb-1 inline-block">Spot</span>
                    <h3 id="modal-title" class="font-bold text-2xl serif-font text-shadow">標題</h3>
                </div>
            </div>
            <div class="p-6 overflow-y-auto no-scrollbar flex-grow">
                <div id="modal-highlight" class="hidden bg-blue-50 border border-blue-100 rounded-lg p-3 mb-4 flex items-start">
                    <i class="fas fa-clipboard-check text-blue-600 mt-1 mr-3"></i>
                    <div>
                        <p class="text-xs text-blue-500 font-bold uppercase">Booking / Note</p>
                        <div id="modal-highlight-content" class="text-sm font-bold text-gray-800"></div>
                    </div>
                </div>
                <div class="flex items-center mb-4 text-sm text-gray-600">
                    <i class="far fa-clock w-5 text-center mr-2 text-blue-600"></i>
                    <span id="modal-hours">時間載入中...</span>
                </div>
                <div class="flex items-center mb-4 text-sm text-gray-600">
                    <i class="fas fa-map-pin w-5 text-center mr-2 text-red-500"></i>
                    <span id="modal-address">位置資訊</span>
                </div>
                <div class="prose prose-sm text-gray-600 leading-relaxed">
                    <p id="modal-desc">內容...</p>
                </div>
                <div id="modal-veg" class="hidden mt-4 p-3 bg-green-50 rounded-lg border border-green-100 text-xs text-green-800">
                    <i class="fas fa-seedling mr-1"></i> <strong>素食提示：</strong> <span id="modal-veg-content"></span>
                </div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-gray-50">
                <a id="modal-map-btn" href="#" target="_blank" class="block w-full bg-blue-600 hover:bg-blue-700 text-white text-center py-3 rounded-xl font-bold shadow-lg transition transform active:scale-95">
                    <i class="fas fa-location-arrow mr-2"></i> 開啟導航
                </a>
            </div>
        </div>
    </div>

    <div id="tips-modal" class="modal hidden fixed inset-0 bg-black/80 z-[70] flex items-center justify-center p-6 backdrop-blur-sm" onclick="if(event.target === this) closeTipsModal()">
        <div class="bg-white rounded-2xl max-w-sm w-full p-6 relative shadow-2xl border-t-8 border-yellow-400">
            <button onclick="closeTipsModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
            <h3 class="text-2xl font-bold text-blue-900 mb-4 serif-font"><i class="fas fa-clipboard-list mr-2"></i>行前準備 & 預訂</h3>
            <div class="space-y-4 max-h-[60vh] overflow-y-auto pr-2 no-scrollbar">
                
                <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                    <h4 class="font-bold text-sm text-yellow-800 mb-2"><i class="fas fa-utensils mr-1"></i> 餐廳預訂清單</h4>
                    <ul class="text-xs text-gray-700 space-y-1">
                        <li><strong>D1 午餐：</strong>樂軒華 (6人，建議靠窗)</li>
                        <li><strong>D1 晚餐：</strong>上葡京自助山 (4人) / JW萬豪 (2人)</li>
                        <li><strong>D2 午餐：</strong>La Famiglia (6人)</li>
                        <li><strong>D2 晚餐：</strong>瑞吉雅舍 (Check-in時確認素食)</li>
                    </ul>
                </div>

                <div class="flex items-start">
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mr-3 flex-shrink-0"><i class="fas fa-taxi"></i></div>
                    <div><h4 class="font-bold text-sm">交通 APP</h4><p class="text-xs text-gray-500 mt-1">下載「澳門電召 (Macau Taxi)」。6人需分兩台車，或嘗試預約藍色6人座車。</p></div>
                </div>

                <div class="flex items-start">
                    <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 mr-3 flex-shrink-0"><i class="fas fa-leaf"></i></div>
                    <div><h4 class="font-bold text-sm">素食小卡</h4><p class="text-xs text-gray-500 mt-1">請準備：「我不吃肉、蔥、蒜、肉湯」(No Meat, Onion, Garlic, Meat broth)。</p></div>
                </div>

                <div class="flex items-start">
                    <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center text-red-600 mr-3 flex-shrink-0"><i class="fas fa-exclamation-triangle"></i></div>
                    <div><h4 class="font-bold text-sm">分流提醒 (Day 2)</h4><p class="text-xs text-gray-500 mt-1">返台友人需於 15:00 前離開官也街前往機場。</p></div>
                </div>
            </div>
            <button onclick="closeTipsModal()" class="w-full bg-blue-600 text-white py-2 rounded-lg font-bold mt-6">我知道了</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // --- 1. 2025 更新版行程數據 ---
        const scheduleData = {
            day1: [
                { 
                    time: "10:00", type: "flight", title: "抵達澳門 (NX631)", 
                    desc: "TPE ✈️ MFM (10:00 抵達)", 
                    icon: "fa-plane-arrival", 
                    modal: { 
                        tag: "Arrival", title: "NX631 抵達", 
                        desc: "抵達澳門國際機場。出關後請分乘 2 台計程車前往澳門十六浦索菲特。", 
                        hours: "10:00 落地", address: "澳門國際機場", 
                        highlight: "6人團體需分 2 台車", 
                        img: "https://placehold.co/600x400/005DC7/FFF?text=Arrival+MFM" 
                    } 
                },
                { 
                    time: "13:30", type: "food", title: "午餐：樂軒華粵菜", 
                    desc: "索菲特 18F (270度江景)", 
                    icon: "fa-utensils", 
                    modal: { 
                        tag: "Lunch", title: "樂軒華 Le Chinois", 
                        desc: "位於飯店18樓，環境舒適免奔波。擁有絕佳內港景色。", 
                        hours: "預訂：13:30 (6人)", address: "十六浦索菲特 18樓", 
                        highlight: "建議預訂靠窗位", 
                        veg: "五星級中餐廳，有點心及素食熱炒，素食無虞。", 
                        img: "https://placehold.co/600x400/D4AF37/FFF?text=Le+Chinois" 
                    } 
                },
                { 
                    time: "15:00", type: "sight", title: "漫步大三巴", 
                    desc: "議事亭前地 → 戀愛巷", 
                    icon: "fa-walking", 
                    modal: { 
                        tag: "Sightseeing", title: "歷史城區漫步", 
                        desc: "步行約8分鐘至議事亭前地。路線：玫瑰堂 → 義順牛奶(下午茶) → 大三巴牌坊 → 戀愛巷。", 
                        hours: "預計 2 小時", address: "大三巴街", 
                        img: "https://placehold.co/600x400/4a5568/FFF?text=Ruins+of+St.Paul" 
                    } 
                },
                { 
                    time: "17:00", type: "transport", title: "移動至路氹", 
                    desc: "搭車前往 JW萬豪/上葡京", 
                    icon: "fa-taxi", 
                    modal: { 
                        tag: "Transport", title: "跨海移動", 
                        desc: "搭乘計程車前往路氹城區準備晚餐。", 
                        hours: "-", address: "目的地：澳門銀河 / 上葡京", 
                        img: "https://placehold.co/600x400/1a202c/FFF?text=Taxi+To+Cotai" 
                    } 
                },
                { 
                    time: "19:00", type: "food", title: "晚餐：名廚都匯 / 自助山", 
                    desc: "⚠️ 分流用餐", 
                    icon: "fa-users-slash", 
                    modal: { 
                        tag: "Split Dinner", title: "晚餐分流安排", 
                        desc: "<b>【2人組】</b>JW萬豪「名廚都匯」(生日優惠)：龍蝦、生蠔、北京填鴨。<br><br><b>【4人組】</b>上葡京「自助山」：澳門最豐富自助餐。", 
                        hours: "預訂：19:00", address: "JW萬豪 / 上葡京", 
                        highlight: "餐後搭車回索菲特休息", 
                        img: "https://placehold.co/600x400/2d3748/FFF?text=Buffet+Dinner" 
                    } 
                }
            ],
            day2: [
                { 
                    time: "10:00", type: "hotel", title: "Checkout & 移動", 
                    desc: "前往瑞吉寄放行李", 
                    icon: "fa-suitcase-rolling", 
                    modal: { 
                        tag: "Logistics", title: "移動日", 
                        desc: "辦理索菲特退房，搭計程車前往澳門瑞吉酒店 (The St. Regis) 寄放行李。", 
                        hours: "10:00 出發", address: "澳門瑞吉酒店", 
                        img: "https://placehold.co/600x400/2b6cb0/FFF?text=Move+to+St.Regis" 
                    } 
                },
                { 
                    time: "11:30", type: "food", title: "午餐：La Famiglia", 
                    desc: "官也街葡意料理", 
                    icon: "fa-utensils", 
                    modal: { 
                        tag: "Lunch", title: "La Famiglia (葡意料理)", 
                        desc: "位於官也街巷弄，環境溫馨適合團體。餐後可逛莫義記、安德魯蛋塔。", 
                        hours: "預訂：11:30 (6人)", address: "氹仔木鐸街76號", 
                        veg: "可客製素食義大利麵/燉飯，有多款沙拉。", 
                        img: "https://placehold.co/600x400/ed8936/FFF?text=La+Famiglia" 
                    } 
                },
                { 
                    time: "14:00", type: "plane-departure", title: "⚠️ 分流：送機", 
                    desc: "1人返台 / 5人續留", 
                    icon: "fa-user-clock", 
                    modal: { 
                        tag: "Split", title: "分流時刻", 
                        desc: "<b>【返台友人】</b> 15:00 前需離開官也街，回飯店取行李或直奔機場 (NX618 17:35 起飛)。<br><br><b>【續留 5人】</b> 步行回瑞吉酒店 Check-in。", 
                        hours: "14:00 - 15:00", address: "前往機場 / 瑞吉", 
                        highlight: "NX618 17:35 起飛", 
                        img: "https://placehold.co/600x400/e53e3e/FFF?text=Airport+Split" 
                    } 
                },
                { 
                    time: "15:00", type: "hotel", title: "瑞吉 Check-in", 
                    desc: "倫敦人探索 / 管家服務", 
                    icon: "fa-concierge-bell", 
                    modal: { 
                        tag: "Check-in", title: "入住瑞吉 & 倫敦人", 
                        desc: "體驗瑞吉管家服務(泡茶/咖啡)。參觀倫敦人水晶金殿、國會大廈外牆。", 
                        hours: "15:00 入住", address: "澳門瑞吉酒店", 
                        highlight: "Check-in時請再次確認晚餐素食", 
                        img: "https://placehold.co/600x400/1a202c/FFF?text=The+Londoner" 
                    } 
                },
                { 
                    time: "18:30", type: "food", title: "晚餐：瑞吉雅舍", 
                    desc: "The Manor Fine Dining", 
                    icon: "fa-wine-glass-alt", 
                    modal: { 
                        tag: "Dinner", title: "雅舍 The Manor", 
                        desc: "享用飯店包含的晚餐套餐。環境優雅，服務頂級。", 
                        hours: "預訂：18:30", address: "瑞吉酒店 1樓", 
                        veg: "主廚可準備 Vegetarian Set (需提前告知)。", 
                        img: "https://placehold.co/600x400/744210/FFF?text=The+Manor" 
                    } 
                }
            ],
            day3: [
                { 
                    time: "09:00", type: "coffee", title: "早餐：瑞吉雅舍", 
                    desc: "半自助式頂級早餐", 
                    icon: "fa-mug-hot", 
                    modal: { 
                        tag: "Breakfast", title: "雅舍早餐", 
                        desc: "著名的半自助早餐，主餐現點現做 (推薦龍蝦蛋、牛排蛋)。", 
                        hours: "09:00", address: "瑞吉酒店 1樓", 
                        img: "https://placehold.co/600x400/3182ce/FFF?text=St.Regis+Breakfast" 
                    } 
                },
                { 
                    time: "11:00", type: "sight", title: "路環漁村慢活", 
                    desc: "聖方濟各堂 / 十月初五馬路", 
                    icon: "fa-camera-retro", 
                    modal: { 
                        tag: "Sightseeing", title: "路環漁村 Coloane", 
                        desc: "搭車約10分鐘。參觀聖方濟各聖堂、圖書館，感受悠閒漁村風情。必買安德魯總店蛋塔。", 
                        hours: "11:00 - 14:00", address: "路環市區", 
                        img: "https://placehold.co/600x400/38a169/FFF?text=Coloane+Village" 
                    } 
                },
                { 
                    time: "12:30", type: "food", title: "午餐：雅憩花園", 
                    desc: "教堂前大樹下用餐", 
                    icon: "fa-tree", 
                    modal: { 
                        tag: "Lunch", title: "雅憩花園餐廳 Nga Tim", 
                        desc: "在教堂前的大樹下用餐，氛圍極佳。", 
                        hours: "午餐時段", address: "路環計單奴街", 
                        veg: "推薦：炒雜菜、玉米羹、西洋烚菜、炒飯。", 
                        img: "https://placehold.co/600x400/2f855a/FFF?text=Nga+Tim+Cafe" 
                    } 
                },
                { 
                    time: "15:30", type: "car", title: "前往機場", 
                    desc: "瑞吉出發 (10分鐘車程)", 
                    icon: "fa-taxi", 
                    modal: { 
                        tag: "Departure", title: "前往機場", 
                        desc: "瑞吉離機場極近。搭乘 NX618 返回台北。", 
                        hours: "17:35 起飛", address: "澳門國際機場", 
                        highlight: "Bye Bye Macau!", 
                        img: "https://placehold.co/600x400/005DC7/FFF?text=Airport" 
                    } 
                }
            ]
        };

        const mapLocations = [
            { lat: 22.196, lng: 113.536, title: "十六浦索菲特", day: "D1" },
            { lat: 22.197, lng: 113.540, title: "大三巴牌坊", day: "D1" },
            { lat: 22.149, lng: 113.553, title: "JW萬豪", day: "D1" },
            { lat: 22.140, lng: 113.563, title: "上葡京 (自助山)", day: "D1" },
            { lat: 22.146, lng: 113.556, title: "澳門瑞吉", day: "D2" },
            { lat: 22.153, lng: 113.556, title: "La Famiglia (官也街)", day: "D2" },
            { lat: 22.118, lng: 113.551, title: "路環聖方濟各堂", day: "D3" },
            { lat: 22.158, lng: 113.565, title: "澳門機場", day: "D3" }
        ];

        // --- 2. 渲染邏輯 ---
        function renderTimeline(dayId, data) {
            const container = document.getElementById(`timeline-${dayId}`);
            let html = '';
            
            data.forEach((item, index) => {
                const isLast = index === data.length - 1;
                const modalStr = encodeURIComponent(JSON.stringify(item.modal));

                html += `
                    <div class="flex relative mb-8 ${isLast ? 'last-item' : ''}" onclick="openModal('${modalStr}')">
                        <div class="w-14 text-right pr-3 pt-2 flex-shrink-0 z-10">
                            <span class="text-sm font-bold text-gray-500 font-mono">${item.time}</span>
                        </div>
                        
                        <div class="relative flex flex-col items-center mr-4 z-10">
                            <div class="w-10 h-10 rounded-full bg-white border-2 border-blue-500 shadow-md flex items-center justify-center text-blue-600 z-20">
                                <i class="fas ${item.icon}"></i>
                            </div>
                            <div class="timeline-line"></div>
                        </div>

                        <div class="card-portugal bg-white p-4 rounded-r-xl rounded-bl-xl shadow-sm flex-grow cursor-pointer relative overflow-hidden group">
                            <div class="absolute right-0 top-0 bottom-0 w-16 opacity-10 group-hover:opacity-20 transition">
                                <img src="${item.modal.img}" class="w-full h-full object-cover grayscale">
                            </div>
                            
                            <div class="relative z-10">
                                <h3 class="font-bold text-gray-800 text-lg mb-1 group-hover:text-blue-700 transition">${item.title}</h3>
                                <p class="text-xs text-gray-500 mb-2">${item.desc}</p>
                                <span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-1 rounded border border-blue-100">
                                    <i class="fas fa-info-circle mr-1"></i>詳情
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // --- 3. 互動功能 ---
        document.addEventListener("DOMContentLoaded", () => {
            renderTimeline('day1', scheduleData.day1);
            renderTimeline('day2', scheduleData.day2);
            renderTimeline('day3', scheduleData.day3);
            fetchWeather();
        });

        function switchTab(targetId) {
            document.querySelectorAll('.tab-view').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${targetId}`).classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            document.querySelectorAll('.nav-btn').forEach(btn => {
                if(btn.dataset.target === targetId) {
                    btn.classList.add('text-blue-700', 'scale-110');
                    btn.classList.remove('text-gray-400');
                } else {
                    btn.classList.remove('text-blue-700', 'scale-110');
                    btn.classList.add('text-gray-400');
                }
            });

            if (targetId === 'map') setTimeout(initMap, 200);
        }

        function openModal(dataStr) {
            const data = JSON.parse(decodeURIComponent(dataStr));
            document.getElementById('modal-title').innerText = data.title;
            document.getElementById('modal-tag').innerText = data.tag;
            document.getElementById('modal-desc').innerHTML = data.desc; // Changed to innerHTML for line breaks
            document.getElementById('modal-hours').innerText = data.hours || "依現場為準";
            document.getElementById('modal-address').innerText = data.address;
            document.getElementById('modal-image').src = data.img;
            document.getElementById('modal-map-btn').href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(data.title + " 澳門")}`;
            
            const highlightEl = document.getElementById('modal-highlight');
            if(data.highlight) { highlightEl.classList.remove('hidden'); document.getElementById('modal-highlight-content').innerText = data.highlight; } else { highlightEl.classList.add('hidden'); }

            const vegEl = document.getElementById('modal-veg');
            if(data.veg) { vegEl.classList.remove('hidden'); document.getElementById('modal-veg-content').innerText = data.veg; } else { vegEl.classList.add('hidden'); }

            document.getElementById('info-modal').classList.remove('hidden');
            document.getElementById('info-modal').classList.add('flex');
        }

        function closeModal() { document.getElementById('info-modal').classList.add('hidden'); document.getElementById('info-modal').classList.remove('flex'); }
        function openTipsModal() { document.getElementById('tips-modal').classList.remove('hidden'); document.getElementById('tips-modal').classList.add('flex'); }
        function closeTipsModal() { document.getElementById('tips-modal').classList.add('hidden'); document.getElementById('tips-modal').classList.remove('flex'); }

        async function fetchWeather() {
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=22.1987&longitude=113.5439&current_weather=true');
                const data = await res.json();
                const temp = Math.round(data.current_weather.temperature);
                document.getElementById('weather-temp').innerText = `${temp}°C`;
                document.getElementById('weather-icon').innerHTML = temp > 20 ? '<i class="fas fa-sun text-yellow-400"></i>' : '<i class="fas fa-cloud text-gray-200"></i>';
            } catch (e) { document.getElementById('weather-temp').innerText = "18°C"; }
        }

        let map;
        function initMap() {
            if (map) return;
            map = L.map('map').setView([22.16, 113.55], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: '&copy; OpenStreetMap', maxZoom: 20 }).addTo(map);
            mapLocations.forEach((loc, index) => {
                const iconHtml = `<div class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold border-2 border-white shadow-lg font-mono">${index + 1}</div>`;
                const customIcon = L.divIcon({ html: iconHtml, className: 'custom-div-icon', iconSize: [32, 32], iconAnchor: [16, 16] });
                L.marker([loc.lat, loc.lng], {icon: customIcon}).addTo(map).bindPopup(`<b class="text-blue-800">${loc.title}</b><br><span class="text-xs text-gray-500">${loc.day}</span>`);
            });
        }
    </script>
</body>
</html>